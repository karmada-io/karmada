# test case for interpreting status of SparkApplication
# case1. SparkApplication: interpret status test
# case2. SparkApplication: interpret status with no status
# case3. SparkApplication: interpret status with applicationState but missing state
# case4. SparkApplication: interpret status with partial status fields
# case5. SparkApplication: interpret status with empty executorState

name: "SparkApplication: interpret status test"
description: "Test interpreting status for SparkApplication"
observedObj:
  apiVersion: sparkoperator.k8s.io/v1beta2
  kind: SparkApplication
  metadata:
    annotations:
      kubectl.kubernetes.io/last-applied-configuration: |
        {"apiVersion":"sparkoperator.k8s.io/v1beta2","kind":"SparkApplication","metadata":{"annotations":{},"name":"spark-pi","namespace":"default"},"spec":{"driver":{"cores":2,"labels":{"version":"3.5.0"},"memory":"512m","serviceAccount":"spark-operator-spark","volumeMounts":[{"mountPath":"/tmp","name":"test-volume"}]},"executor":{"cores":1,"instances":2,"labels":{"version":"3.5.0"},"memory":"512m","volumeMounts":[{"mountPath":"/tmp","name":"test-volume"}]},"image":"spark:3.5.0","imagePullPolicy":"Always","mainApplicationFile":"local:///opt/spark/examples/jars/spark-examples_2.12-3.5.0.jar","mainClass":"org.apache.spark.examples.SparkPi","mode":"cluster","restartPolicy":{"type":"Never"},"sparkUIOptions":{"serviceLabels":{"test-label/v1":"true"}},"sparkVersion":"3.5.0","type":"Scala","volumes":[{"hostPath":{"path":"/tmp","type":"Directory"},"name":"test-volume"}]}}
      propagationpolicy.karmada.io/name: spark-pi-pp
      propagationpolicy.karmada.io/namespace: default
    creationTimestamp: "2025-10-12T13:57:17Z"
    generation: 1
    labels:
      propagationpolicy.karmada.io/permanent-id: 5c1aa82e-d727-4ec4-8d58-5d3cff7335e1
    name: spark-pi
    namespace: default
    resourceVersion: "1152"
    uid: 30dde6fb-dc13-40fd-b131-4839fdf7fddd
  spec:
    driver:
      cores: 2
      labels:
        version: 3.5.0
      memory: 512m
      serviceAccount: spark-operator-spark
      volumeMounts:
        - mountPath: /tmp
          name: test-volume
    executor:
      cores: 1
      instances: 2
      labels:
        version: 3.5.0
      memory: 512m
      volumeMounts:
        - mountPath: /tmp
          name: test-volume
    image: spark:3.5.0
    imagePullPolicy: Always
    mainApplicationFile: local:///opt/spark/examples/jars/spark-examples_2.12-3.5.0.jar
    mainClass: org.apache.spark.examples.SparkPi
    mode: cluster
    restartPolicy:
      type: Never
    sparkUIOptions:
      serviceLabels:
        test-label/v1: "true"
    sparkVersion: 3.5.0
    type: Scala
    volumes:
      - hostPath:
          path: /tmp
          type: Directory
        name: test-volume
  status:
    applicationState:
      state: COMPLETED
    driverInfo:
      podName: spark-pi-driver
      webUIAddress: 10.11.254.226:4040
      webUIPort: 4040
      webUIServiceName: spark-pi-ui-svc
    executionAttempts: 1
    executorState:
      spark-pi-b5777a99d8b732a7-exec-1: COMPLETED
      spark-pi-b5777a99d8b732a7-exec-2: COMPLETED
    lastSubmissionAttemptTime: "2025-10-12T13:57:17Z"
    sparkApplicationId: spark-ff27607fd312454b92455e2feabdd343
    submissionAttempts: 1
    submissionID: 0df4a04b-620b-425e-997a-e4404010e26a
    terminationTime: "2025-10-12T13:58:39Z"
operation: InterpretStatus
output:
  status:
    applicationState:
      state: COMPLETED
    driverInfo:
      podName: spark-pi-driver
      webUIAddress: 10.11.254.226:4040
      webUIPort: 4040
      webUIServiceName: spark-pi-ui-svc
    executorState:
      spark-pi-b5777a99d8b732a7-exec-1: COMPLETED
      spark-pi-b5777a99d8b732a7-exec-2: COMPLETED
    sparkApplicationId: spark-ff27607fd312454b92455e2feabdd343
    lastSubmissionAttemptTime: "2025-10-12T13:57:17Z"
    submissionAttempts: 1
    executionAttempts: 1
    submissionID: 0df4a04b-620b-425e-997a-e4404010e26a
    terminationTime: "2025-10-12T13:58:39Z"
---
name: "SparkApplication interpret status with no status"
description: "InterpretStatus should return empty status when observed status is nil"
observedObj:
  apiVersion: sparkoperator.k8s.io/v1beta2
  kind: SparkApplication
  metadata:
    name: spark-pi
    namespace: default
operation: InterpretStatus
output:
  status: {}
---
name: "SparkApplication interpret status with applicationState but missing state"
description: "InterpretStatus should copy applicationState even if state field is missing"
observedObj:
  apiVersion: sparkoperator.k8s.io/v1beta2
  kind: SparkApplication
  metadata:
    name: spark-pi
    namespace: default
  status:
    applicationState: {}
operation: InterpretStatus
output:
  status: {}
---
name: "SparkApplication interpret status with partial status fields"
description: "InterpretStatus should copy existing fields and ignore nil ones"
observedObj:
  apiVersion: sparkoperator.k8s.io/v1beta2
  kind: SparkApplication
  metadata:
    name: spark-pi
    namespace: default
  status:
    driverInfo:
      podName: spark-pi-driver
      webUIPort: 4040
operation: InterpretStatus
output:
  status:
    driverInfo:
      podName: spark-pi-driver
      webUIPort: 4040
---
name: "SparkApplication interpret status with empty executorState"
description: "Empty executorState should be copied as-is"
observedObj:
  apiVersion: sparkoperator.k8s.io/v1beta2
  kind: SparkApplication
  metadata:
    name: spark-pi
    namespace: default
  status:
    executorState: {}
operation: InterpretStatus
output:
  status: {}
