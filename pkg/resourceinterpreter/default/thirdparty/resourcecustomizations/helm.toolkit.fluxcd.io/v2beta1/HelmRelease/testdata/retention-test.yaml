# test case for retaining fields of HelmRelease
# case1. HelmRelease with suspend=true should retain suspend field
# case2. HelmRelease with suspend=false should retain suspend field
# case3. HelmRelease without suspend field should not modify desiredObj

name: "HelmRelease with suspend=true should retain suspend field"
description: "Test retaining suspend field when observedObj has suspend=true"
desiredObj:
  apiVersion: helm.toolkit.fluxcd.io/v2beta1
  kind: HelmRelease
  metadata:
    name: sample
    namespace: default
  spec:
    interval: 5m
    chart:
      spec:
        chart: "./charts/podinfo"
        version: ">=4.0.0 <5.0.0"
observedObj:
  apiVersion: helm.toolkit.fluxcd.io/v2beta1
  kind: HelmRelease
  metadata:
    name: sample
    namespace: default
  spec:
    suspend: true
operation: Retain
output:
  retained:
    apiVersion: helm.toolkit.fluxcd.io/v2beta1
    kind: HelmRelease
    metadata:
      name: sample
      namespace: default
    spec:
      interval: 5m
      suspend: true
      chart:
        spec:
          chart: "./charts/podinfo"
          version: ">=4.0.0 <5.0.0"

---
name: "HelmRelease with suspend=false should retain suspend field"
description: "Test retaining suspend field when observedObj has suspend=false"
desiredObj:
  apiVersion: helm.toolkit.fluxcd.io/v2beta1
  kind: HelmRelease
  metadata:
    name: sample
    namespace: default
  spec:
    interval: 5m
    chart:
      spec:
        chart: "./charts/podinfo"
        version: ">=4.0.0 <5.0.0"
observedObj:
  apiVersion: helm.toolkit.fluxcd.io/v2beta1
  kind: HelmRelease
  metadata:
    name: sample
    namespace: default
  spec:
    suspend: false
operation: Retain
output:
  retained:
    apiVersion: helm.toolkit.fluxcd.io/v2beta1
    kind: HelmRelease
    metadata:
      name: sample
      namespace: default
    spec:
      interval: 5m
      suspend: false
      chart:
        spec:
          chart: "./charts/podinfo"
          version: ">=4.0.0 <5.0.0"

---
name: "HelmRelease without suspend field should not modify desiredObj"
description: "Test that desiredObj is not modified when observedObj does not have suspend field"
desiredObj:
  apiVersion: helm.toolkit.fluxcd.io/v2beta1
  kind: HelmRelease
  metadata:
    name: sample
    namespace: default
  spec:
    interval: 5m
    chart:
      spec:
        chart: "./charts/podinfo"
        version: ">=4.0.0 <5.0.0"
observedObj:
  apiVersion: helm.toolkit.fluxcd.io/v2beta1
  kind: HelmRelease
  metadata:
    name: sample
    namespace: default
  spec:
    interval: 5m
    chart:
      spec:
        chart: "./charts/podinfo"
        version: ">=4.0.0 <5.0.0"
operation: Retain
output:
  retained:
    apiVersion: helm.toolkit.fluxcd.io/v2beta1
    kind: HelmRelease
    metadata:
      name: sample
      namespace: default
    spec:
      interval: 5m
      chart:
        spec:
          chart: "./charts/podinfo"
          version: ">=4.0.0 <5.0.0"

