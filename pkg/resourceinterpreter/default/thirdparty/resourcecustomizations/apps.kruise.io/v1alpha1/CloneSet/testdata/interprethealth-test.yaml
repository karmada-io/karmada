# test case for interpreting health of CloneSet
# case1. CloneSet interpreting health test
# case2. CloneSet health when observedGeneration mismatches generation
# case3. CloneSet health when updatedReplicas less than desired replicas
# case4. CloneSet health when availableReplicas less than updatedReplicas

name: "CloneSet interpreting health test"
description: "Test interpreting health of CloneSet"
observedObj:
  apiVersion: apps.kruise.io/v1alpha1
  kind: CloneSet
  metadata:
    annotations:
      resourcetemplate.karmada.io/generation: "1"
    labels:
      app: sample
    name: sample
    namespace: test-cloneset
    generation: 1
  spec:
    replicas: 2
    selector:
      matchLabels:
        app: sample
        test: cloneset
    template:
      metadata:
        labels:
          app: sample
          test: cloneset
      spec:
        volumes:
          - name: configmap
            configMap:
              name: my-sample-config
        containers:
          - name: nginx
            image: nginx:alpine
            env:
              - name: logData
                valueFrom:
                  configMapKeyRef:
                    name: mysql-config
                    key: log
              - name: lowerData
                valueFrom:
                  configMapKeyRef:
                    name: mysql-config
                    key: lower
  status:
    availableReplicas: 2
    collisionCount: 0
    currentRevision: sample-59df6bd888
    expectedUpdatedReplicas: 2
    labelSelector: app=sample,test=cloneset
    observedGeneration: 1
    readyReplicas: 2
    replicas: 2
    updateRevision: sample-59df6bd888
    updatedReadyReplicas: 2
    updatedReplicas: 2
operation: InterpretHealth
output:
  healthy: true
---
name: "CloneSet health when observedGeneration mismatches generation"
description: "Health should be false when observedGeneration != generation"
observedObj:
  apiVersion: apps.kruise.io/v1alpha1
  kind: CloneSet
  metadata:
    annotations:
      resourcetemplate.karmada.io/generation: "1"
    name: sample
    namespace: test-cloneset
    generation: 2
  spec:
    replicas: 2
    template:
      spec:
        containers:
          - name: nginx
            image: nginx:alpine
  status:
    observedGeneration: 1
    updatedReplicas: 2
    availableReplicas: 2
operation: InterpretHealth
output:
  healthy: false
---
name: "CloneSet health when updatedReplicas less than desired replicas"
description: "Health should be false when updatedReplicas < spec.replicas"
observedObj:
  apiVersion: apps.kruise.io/v1alpha1
  kind: CloneSet
  metadata:
    annotations:
      resourcetemplate.karmada.io/generation: "1"
    name: sample
    namespace: test-cloneset
    generation: 1
  spec:
    replicas: 3
    template:
      spec:
        containers:
          - name: nginx
            image: nginx:alpine
  status:
    observedGeneration: 1
    updatedReplicas: 2
    availableReplicas: 2
operation: InterpretHealth
output:
  healthy: false
---
name: "CloneSet health when availableReplicas less than updatedReplicas"
description: "Health should be false when availableReplicas < updatedReplicas"
observedObj:
  apiVersion: apps.kruise.io/v1alpha1
  kind: CloneSet
  metadata:
    annotations:
      resourcetemplate.karmada.io/generation: "1"
    name: sample
    namespace: test-cloneset
    generation: 1
  spec:
    replicas: 2
    template:
      spec:
        containers:
          - name: nginx
            image: nginx:alpine
  status:
    observedGeneration: 1
    updatedReplicas: 2
    availableReplicas: 1
operation: InterpretHealth
output:
  healthy: false  
