# test case for interpreting replica of BroadcastJob
# case1. BroadcastJob with parallelism set to 1
# case2. BroadcastJob with parallelism set to 3
# case3. BroadcastJob without parallelism

name: "BroadcastJob with parallelism set to 1"
description: "Test interpreting replica of BroadcastJob with parallelism set to 1"
desiredObj:
  apiVersion: apps.kruise.io/v1alpha1
  kind: BroadcastJob
  metadata:
    labels:
      app: sample
    name: sample
    namespace: test-bcj
  spec:
    parallelism: 1
    template:
      metadata:
        labels:
          app: sample
      spec:
        restartPolicy: Never
        volumes:
          - name: configmap
            configMap:
              name: my-sample-config
        containers:
          - name: nginx
            image: nginx:alpine
            env:
              - name: logData
                valueFrom:
                  configMapKeyRef:
                    name: mysql-config
                    key: log
              - name: lowerData
                valueFrom:
                  configMapKeyRef:
                    name: mysql-config
                    key: lower
    completionPolicy:
      type: Always
      activeDeadlineSeconds: 10
operation: InterpretReplica
output:
  replica: 1
---
name: "BroadcastJob with parallelism set to 3"
description: "Test interpreting replica of BroadcastJob with parallelism set to 3"
desiredObj:
  apiVersion: apps.kruise.io/v1alpha1
  kind: BroadcastJob
  metadata:
    name: sample
    namespace: test-bcj
  spec:
    parallelism: 3
    template:
      spec:
        containers:
          - name: nginx
            image: nginx:alpine
operation: InterpretReplica
output:
  replica: 3
---
name: "BroadcastJob without parallelism"
description: "Test interpreting replica when parallelism is not specified"
desiredObj:
  apiVersion: apps.kruise.io/v1alpha1
  kind: BroadcastJob
  metadata:
    name: sample
    namespace: test-bcj
  spec:
    template:
      spec:
        containers:
          - name: nginx
            image: nginx:alpine
operation: InterpretReplica
output:
  replica: 1
